# CVE Scraper

**CVE Scraper** is a Python tool that periodically fetches CVE (Common Vulnerabilities and Exposures) data from the NVD API based on configurable keywords, stores the results in an SQLite database, and sends email alerts when new CVEs are detected.

---

## Features

- **Keyword-based searches** via NVD REST API (`cves/2.0`).
- **SQLite** persistence with a single `cve_records` table.
- **Email notifications** for newly discovered CVEs.
- Flexible **configuration** via `config.json` and `.env`.
- Secure **secret management** using Docker Secrets (fallback to environment variables).
- **Periodic scheduling** using the `schedule` library.

---

## Prerequisites

- Python 3.8
- PIP
- Docker & Docker Compose (if using containerization)
- A Gmail account with **App Password** enabled for SMTP (if using Gmail)
- Dependencies installed via pip install -r requirements.txt, including:
```
requests
schedule
python-dotenv
beautifulsoup4
```
---

## Configuration

### 1. `config.json`

Defines search keywords, scheduling, and email settings **without** credentials.

```json
{
  "keywords": ["rapidjson", "hsm"],
  "interval_hours": 2,
  "email": {
    "smtp_server": "smtp.gmail.com",
    "smtp_port": 587,
    "use_tls": true,
    "from": "alerts@example.com",
    "to": ["you@example.com"]
  }
}
```

- `keywords`: List of terms to query against the NVD API.
- `interval_hours`: Time between runs (in hours).
- `email`: SMTP host, port, TLS flag, sender (`from`), and recipient list (`to`).

### 2. `.env`

(Optional) Override SMTP credentials locally. This file **must not** be committed.

```dotenv
SMTP_USER=your@gmail.com
SMTP_PASS=your_app_password_16chars
```

### 3. Docker Secrets

For production, use Docker Secrets instead of `.env`:

- Create secrets:
  ```bash
  echo "your@gmail.com" | docker secret create smtp_user -
  echo "your_app_password_16chars" | docker secret create smtp_pass -
  ```
- In `docker-compose.yml`, mount secrets at `/run/secrets/smtp_user` and `/run/secrets/smtp_pass`.

---

## Docker Setup

### Dockerfile

The included `Dockerfile`:

```dockerfile
FROM python:3.10-slim
WORKDIR /app

# System deps
RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential && rm -rf /var/lib/apt/lists/*

# Python deps
COPY requirements.txt /app/
RUN pip install --no-cache-dir -r requirements.txt

# App code
COPY cve_scraper.py config.json /app/
ENV CONFIG_PATH=/app/config.json DB_PATH=/app/cve_records.db

CMD ["python", "cve_scraper.py"]
```

### `docker-compose.yml`

```yaml
version: "3.7"
services:
  cve-scraper:
    build: .
    restart: unless-stopped
    secrets:
      - smtp_user
      - smtp_pass
    environment:
      - CONFIG_PATH=/app/config.json
      - DB_PATH=/app/cve_records.db
      - SMTP_USER_FILE=/run/secrets/smtp_user
      - SMTP_PASS_FILE=/run/secrets/smtp_pass
    volumes:
      - ./config.json:/app/config.json:ro
      - data:/app

secrets:
  smtp_user:
    external: true
  smtp_pass:
    external: true

volumes:
  data: {}
```

---

## Quick Start

1. \*\*Prepare \*\*\`\` with your desired keywords and email settings.
2. **(Local dev)** Create `.env` (ignored by Git):
   ```bash
   cp .env.example .env
   # then edit SMTP_USER and SMTP_PASS
   ```
3. **(Prod)** Create Docker secrets:
   ```bash
   echo "your@gmail.com" | docker secret create smtp_user -
   echo "your_app_password" | docker secret create smtp_pass -
   ```
4. **Build and run**:
   ```bash
   docker-compose up -d --build
   ```
5. **Monitor logs**:
   ```bash
   docker-compose logs -f cve-scraper
   ```

---

## Troubleshooting

- **SMTP 535 Bad Credentials**: Ensure App Password is generated and correctly stored (no extra whitespace).
- **DB permissions**: If running in Docker on Linux, ensure the `data` volume directory has write permissions.
- **API rate limits**: NVD enforces rate limitsâ€”consider adding retries or caching if you hit limits.

---

## Extending

- **Use a different SMTP provider**: change `smtp_server`, `smtp_port`, and TLS settings in `config.json`.
- **Filter by date**: extend API query params (e.g., `pubStartDate` / `pubEndDate`).
- **Webhooks**: instead of email, post alerts to Slack or other services.

---

*Disclaimer: This tool is provided as-is. Use responsibly and respect NVD usage policies.*

